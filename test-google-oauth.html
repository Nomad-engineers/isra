<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth Test</title>
</head>
<body>
    <h1>Google OAuth Test</h1>
    <div id="status">Testing Google API...</div>
    <div id="error" style="color: red;"></div>
    <button onclick="testGoogleSignIn()">Test Google Sign-In</button>

    <div id="debug"></div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        const clientId = '673993847428-0eo30q2tttk7hajf5cfhrmvs9v03jqll.apps.googleusercontent.com';
        const currentOrigin = window.location.origin;

        document.getElementById('debug').innerHTML = `
            <h3>Debug Info:</h3>
            <p><strong>Client ID:</strong> ${clientId}</p>
            <p><strong>Current Origin:</strong> ${currentOrigin}</p>
            <p><strong>Expected Origin:</strong> http://localhost:3000</p>
        `;

        // Test Google API status
        fetch(`https://accounts.google.com/gsi/status?client_id=${clientId}`)
            .then(response => {
                document.getElementById('status').innerHTML = `
                    <strong>Google API Status:</strong><br>
                    Status: ${response.status} ${response.statusText}<br>
                    <pre>${JSON.stringify(response.headers.get('content-type'), null, 2)}</pre>
                `;

                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`Status: ${response.status}`);
                }
            })
            .then(data => {
                document.getElementById('status').innerHTML = `
                    <strong style="color: green;">✅ Google API is accessible!</strong><br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            })
            .catch(error => {
                document.getElementById('error').innerHTML = `
                    <strong style="color: red;">❌ Google API Error:</strong><br>
                    ${error.message}<br><br>
                    <strong>Common fixes:</strong><br>
                    1. Wait 5-10 minutes after saving Google Cloud Console settings<br>
                    2. Check that "${currentOrigin}" is in Authorized JavaScript origins<br>
                    3. Ensure Client ID is correct<br>
                    4. Try clearing browser cache
                `;
            });

        function testGoogleSignIn() {
            if (window.google) {
                window.google.accounts.id.initialize({
                    client_id: clientId,
                    callback: (response) => {
                        document.getElementById('status').innerHTML = `
                            <strong style="color: green;">✅ SUCCESS! Google OAuth works!</strong><br>
                            <pre>${JSON.stringify(response, null, 2)}</pre>
                        `;

                        // Decode and show user info
                        const payload = JSON.parse(atob(response.credential.split('.')[1]));
                        alert(`Success! User: ${payload.name} (${payload.email})`);
                    }
                });

                window.google.accounts.id.prompt();
            } else {
                document.getElementById('error').innerHTML = 'Google API not loaded';
            }
        }
    </script>
</body>
</html>